<div class="main-wrapper">

	<div class="row page-titles mx-0">
		<div class="col-sm-6 p-md-0">
			<div class="welcome-text">
				<h4>About Page Operations</h4> 
			</div>
		</div>
		<div class="col-sm-6 p-md-0 justify-content-sm-end mt-2 mt-sm-0 d-flex">
			<ol class="breadcrumb">
				<li class="breadcrumb-item"><a routerLink="/admin-buffalo/master-dashboard">Home</a></li>
				<li class="breadcrumb-item active"><a routerLink="/admin-buffalo/system-information-management/other-pages/dashboard-about">About</a></li>
				<li class="breadcrumb-item active"><a routerLink="/admin-buffalo/system-information-management/other-pages/dashboard-about">All About</a></li>
			</ol>
		</div>
    </div> 

	<!-- Add About Popup -->
	<ng-container *ngIf="addAboutForm.value && addPopupVisible">
		<dx-popup [(visible)]="addPopupVisible" [width]="600" [height]="'auto'" [showTitle]="true"
			[title]="'Add New About'" (onHidden)="onPopupHidden()">
			<form (ngSubmit)="onAddAboutSubmit(false)" [formGroup]="addAboutForm">

				<div class="row">
					<div class="col-lg-12">
						<label for="title">Title:<span class="text-danger">*</span></label>
						<dx-text-box [showClearButton]="true" formControlName="title" placeholder="About title"></dx-text-box>
						<!-- Display error message for the title field -->
						<div *ngIf="addAboutForm.get('title')?.invalid && (addAboutForm.get('title')?.touched || addAboutForm.get('title')?.dirty)"
							class="text-danger">
							<ng-container *ngIf="addAboutForm.get('title')?.errors?.['required']">About title is required</ng-container>
							<ng-container *ngIf="addAboutForm.get('title')?.errors?.['pattern']">Invalid About title</ng-container>
						</div>
					</div>

                    <div class="col-lg-12">
						<label for="description">Description:<span class="text-danger">*</span></label>
						<dx-text-box [showClearButton]="true" formControlName="description" placeholder="About description"></dx-text-box>
						<!-- Display error message for the description field -->
						<div *ngIf="addAboutForm.get('description')?.invalid && (addAboutForm.get('description')?.touched || addAboutForm.get('description')?.dirty)"
							class="text-danger">
							<ng-container *ngIf="addAboutForm.get('description')?.errors?.['required']">description is required</ng-container>
							<ng-container *ngIf="addAboutForm.get('description')?.errors?.['pattern']">Invalid description</ng-container>
						</div>
					</div>

                    <div class="col-lg-12">
						<label for="who_we_are">Who We Are:<span class="text-danger">*</span></label>
						<dx-text-box [showClearButton]="true" formControlName="who_we_are" placeholder="who we are"></dx-text-box>
						<!-- Display error message for the who_we_are field -->
						<div *ngIf="addAboutForm.get('who_we_are')?.invalid && (addAboutForm.get('who_we_are')?.touched || addAboutForm.get('who_we_are')?.dirty)"
							class="text-danger">
							<ng-container *ngIf="addAboutForm.get('who_we_are')?.errors?.['required']">who we are field is required</ng-container>
							<ng-container *ngIf="addAboutForm.get('who_we_are')?.errors?.['pattern']">Invalid  who_we_are</ng-container>
						</div>
					</div>

                    <div class="col-lg-12">
						<label for="our_mission">Our Mission:<span class="text-danger">*</span></label>
						<dx-text-box [showClearButton]="true" formControlName="our_mission" placeholder="About our mission"></dx-text-box>
						<!-- Display error message for the our_mission field -->
						<div *ngIf="addAboutForm.get('our_mission')?.invalid && (addAboutForm.get('our_mission')?.touched || addAboutForm.get('our_mission')?.dirty)"
							class="text-danger">
							<ng-container *ngIf="addAboutForm.get('our_mission')?.errors?.['required']">About our mission is required</ng-container>
							<ng-container *ngIf="addAboutForm.get('our_mission')?.errors?.['pattern']">Invalid About our mission</ng-container>
						</div>
					</div>


                    <div class="mt-3 col-lg-12">
                        <label for="content">About Image:<span class="text-danger">*</span></label>
                    
                        <!-- File input that dynamically updates based on About type -->
                        <input #fileInput type="file" (change)="onFileSelected($event)">
                    
                        <!-- Progress bar for file upload -->
                        <div *ngIf="uploadProgress >= 0" style="margin-top: 1rem;">
                            <label>Upload Progress:</label>
                            <div class="progress" style="height: 30px; background-color: #f3f3f3; border-radius: 5px;">
                                <div class="progress-bar" 
                                     role="progressbar" 
                                     [style.width]="uploadProgress + '%'" 
                                     aria-valuenow="uploadProgress"
                                     aria-valuemin="0" 
                                     aria-valuemax="100" 
                                     style="height: 100%; line-height: 30px; background-color: #007bff; color: white; text-align: center; font-weight: bold;">
                                    {{ uploadProgress }}%
                                </div>
                            </div>
                        </div>
                    
                        <!-- Display error message for the content field -->
                        <div *ngIf="addAboutForm.get('content')?.invalid && (addAboutForm.get('content')?.touched || addAboutForm.get('content')?.dirty)"
                             class="text-danger">
                            <ng-container *ngIf="addAboutForm.get('content')?.errors?.['required']">About Image is required</ng-container>
                            <ng-container *ngIf="fileError">{{ fileError }}</ng-container>
                        </div>
                    </div>
                                  
				</div>
	
				<div class="row">
					<div class="button-container-popup">
						<dx-button text="Save and Add Another" type="success" [elementAttr]="{ id: 'first-btn', class: 'pull-right' }"
							(onClick)="onAddAboutSubmit(true)">
							<!-- spinner -->
							<ng-container *ngIf="!isSubmittingSaveAndAddAnother">Save and Add Another</ng-container>
							<ng-container *ngIf="isSubmittingSaveAndAddAnother">
								<div class="spinnerc"></div>
							</ng-container>
							<!-- spinner -->
						</dx-button>
						<dx-button text="Save" type="success" [elementAttr]="{ class: 'pull-right' }"
							(onClick)="onAddAboutSubmit(false)">
							<!-- spinner -->
							<ng-container *ngIf="!isSubmittingSave">Save</ng-container>
							<ng-container *ngIf="isSubmittingSave">
								<div class="spinnerc"></div>
							</ng-container>
							<!-- spinner -->
						</dx-button>
					</div>
				</div>
			</form>
		</dx-popup>
	</ng-container>

	<!-- Update About Popup -->
	<ng-container *ngIf="updateAboutForm.value && updatePopupVisible">
		<dx-popup [(visible)]="updatePopupVisible" [width]="600" [height]="'auto'" [showTitle]="true"
		[title]="'Update About'" (onHidden)="onPopupHidden()">
		<form (ngSubmit)="onUpdateAboutSubmit()" [formGroup]="updateAboutForm">
			<div class="row">
                <div class="col-lg-12">
                    <label for="title">Title:<span class="text-danger">*</span></label>
                    <dx-text-box [showClearButton]="true" formControlName="title" placeholder="About title"></dx-text-box>
                    <!-- Display error message for the title field -->
                    <div *ngIf="addAboutForm.get('title')?.invalid && (addAboutForm.get('title')?.touched || addAboutForm.get('title')?.dirty)"
                        class="text-danger">
                        <ng-container *ngIf="addAboutForm.get('title')?.errors?.['required']">About title is required</ng-container>
                        <ng-container *ngIf="addAboutForm.get('title')?.errors?.['pattern']">Invalid About title</ng-container>
                    </div>
                </div>

                <div class="col-lg-12">
                    <label for="description">Description:<span class="text-danger">*</span></label>
                    <dx-text-box [showClearButton]="true" formControlName="description" placeholder="About description"></dx-text-box>
                    <!-- Display error message for the description field -->
                    <div *ngIf="addAboutForm.get('description')?.invalid && (addAboutForm.get('description')?.touched || addAboutForm.get('description')?.dirty)"
                        class="text-danger">
                        <ng-container *ngIf="addAboutForm.get('description')?.errors?.['required']">description is required</ng-container>
                        <ng-container *ngIf="addAboutForm.get('description')?.errors?.['pattern']">Invalid description</ng-container>
                    </div>
                </div>

                <div class="col-lg-12">
                    <label for="who_we_are">Who We Are:<span class="text-danger">*</span></label>
                    <dx-text-box [showClearButton]="true" formControlName="who_we_are" placeholder="who we are"></dx-text-box>
                    <!-- Display error message for the who_we_are field -->
                    <div *ngIf="addAboutForm.get('who_we_are')?.invalid && (addAboutForm.get('who_we_are')?.touched || addAboutForm.get('who_we_are')?.dirty)"
                        class="text-danger">
                        <ng-container *ngIf="addAboutForm.get('who_we_are')?.errors?.['required']">who we are field is required</ng-container>
                        <ng-container *ngIf="addAboutForm.get('who_we_are')?.errors?.['pattern']">Invalid  who_we_are</ng-container>
                    </div>
                </div>

                <div class="col-lg-12">
                    <label for="our_mission">Our Mission:<span class="text-danger">*</span></label>
                    <dx-text-box [showClearButton]="true" formControlName="our_mission" placeholder="About our mission"></dx-text-box>
                    <!-- Display error message for the our_mission field -->
                    <div *ngIf="addAboutForm.get('our_mission')?.invalid && (addAboutForm.get('our_mission')?.touched || addAboutForm.get('our_mission')?.dirty)"
                        class="text-danger">
                        <ng-container *ngIf="addAboutForm.get('our_mission')?.errors?.['required']">About our mission is required</ng-container>
                        <ng-container *ngIf="addAboutForm.get('our_mission')?.errors?.['pattern']">Invalid About our mission</ng-container>
                    </div>
                </div>


                <div class="mt-3 col-lg-12">
                    <label for="content">About Image:<span class="text-danger">*</span></label>
                
                    <!-- File input that dynamically updates based on About type -->
                    <input #fileInput type="file" (change)="onFileSelected($event)">
                
                    <!-- Progress bar for file upload -->
                    <div *ngIf="uploadProgress >= 0" style="margin-top: 1rem;">
                        <label>Upload Progress:</label>
                        <div class="progress" style="height: 30px; background-color: #f3f3f3; border-radius: 5px;">
                            <div class="progress-bar" 
                                 role="progressbar" 
                                 [style.width]="uploadProgress + '%'" 
                                 aria-valuenow="uploadProgress"
                                 aria-valuemin="0" 
                                 aria-valuemax="100" 
                                 style="height: 100%; line-height: 30px; background-color: #007bff; color: white; text-align: center; font-weight: bold;">
                                {{ uploadProgress }}%
                            </div>
                        </div>
                    </div>
                
                    <!-- Display error message for the content field -->
                    <div *ngIf="addAboutForm.get('content')?.invalid && (addAboutForm.get('content')?.touched || addAboutForm.get('content')?.dirty)"
                         class="text-danger">
                        <ng-container *ngIf="addAboutForm.get('content')?.errors?.['required']">About Image is required</ng-container>
                        <ng-container *ngIf="fileError">{{ fileError }}</ng-container>
                    </div>
                </div>
                              
            </div>
	
			<!-- Update and Cancel Buttons -->
			<div class="row">
			<div class="button-container-popup">
				<dx-button text="Cancel" type="danger" [elementAttr]="{ id: 'first-btn', class: 'pull-right' }"
				(onClick)="updatePopupVisible = false"></dx-button>
				<dx-button text="Update" type="success" [elementAttr]="{ class: 'pull-right' }"
				(onClick)="onUpdateAboutSubmit()">
				<!-- spinner -->
				<ng-container *ngIf="!isSubmitting">Update</ng-container>
				<ng-container *ngIf="isSubmitting">
					<div class="spinnerc"></div>
				</ng-container>
				<!-- spinner -->
				</dx-button>
			</div>
			</div>
		</form>
		</dx-popup>
	</ng-container>
  

	<!-- Delete About Popup -->
	<ng-container *ngIf="deleteAboutForm.value && deletePopupVisible">
		<dx-popup [(visible)]="deletePopupVisible" height="auto" width="auto" [showTitle]="true" title="Delete Confirmation"
			(onHidden)="deletePopupVisible = false">
			<form (ngSubmit)="onDeleteAboutSubmit()" [formGroup]="deleteAboutForm">
				<div>
					<p *ngIf="deleteAboutForm.value && deletePopupVisible" class="confirmation-text">
						Are you sure you want to delete "<strong>{{deleteAboutForm.value.title}}</strong>"?
					</p>
					<div class="button-container-popup">
					  <dx-button text="Cancel" (onClick)="deletePopupVisible = false" [elementAttr]="{ id: 'first-btn', class: 'pull-right' }"></dx-button>
					  <dx-button text="Delete" type="danger" (onClick)="onDeleteAboutSubmit()" [elementAttr]="{ class: 'pull-right' }">
						 <!-- spinner -->
						<ng-container *ngIf="!isSubmitting">Delete</ng-container>
						<ng-container *ngIf="isSubmitting">
							<div class="spinnerc"></div>
						</ng-container>
						<!-- spinner -->
					  </dx-button>
				  </div>
				</div>
			</form>
		</dx-popup>
	</ng-container>

	<!-- Spinner -->
	<div *ngIf="isLoading" class="spinner-container">
		<div class="spinner"></div>
	</div>

	<!-- Data Grid to display About -->
	<div *ngIf="!isLoading">
		<!-- Menu for Add/Delete Actions -->
		<div class="button-container">
			<dx-menu 
				[style]="{ 'background-color': 'lightblue' }"
				(onItemClick)="onMenuItemClick($event)" 
				[items]="permitGeneralAboutMenuItems">
			</dx-menu>
		</div>

		<!-- Data Grid to display Abouts -->
	<dx-data-grid 
	#multipleAboutGrid
	class="table row-border hover" 
	[dataSource]="Abouts" 
	[remoteOperations]='true' 
	[showBorders]="true"
	[allowColumnResizing]="true" 
	[columnHidingEnabled]="false" 
	(onSelectionChanged)="selectionChanged($event)" 
	keyExpr="id">
		<dxo-search-panel [visible]="true"></dxo-search-panel>
		<dxo-paging [enabled]="true"></dxo-paging>
		<dxo-pager [showInfo]="true" infoText="Page #{0}. Total: {1} ({2} items)" [showPageSizeSelector]="true"
			[allowedPageSizes]="[5,10]"></dxo-pager>

		<dxo-selection mode="multiple"></dxo-selection>
		<dxo-group-panel [visible]="true"></dxo-group-panel>

		<!-- menu actions -->
		<dxi-column [width]="150" caption="Action" name="command-editing"
		[allowFiltering]="false" 
		[allowSorting]="false" 
		cellTemplate="cellTemplate">
		<div *dxTemplate="let data of 'cellTemplate'">
		  <dx-menu 
			(onItemClick)="permitAboutActionColClick($event,data)"
			[items]="permitAboutMenuItems">
		  </dx-menu>
		</div>
	    </dxi-column>
		<!-- menu actions -->

		<dxi-column dataField="id" caption="ID" [visible]="false"></dxi-column>
        <dxi-column dataField="title" caption="About Title"></dxi-column>
        <dxi-column dataField="description" caption="Description"></dxi-column>

        <dxi-column dataField="who_we_are" caption="Who We Are"></dxi-column>
        <dxi-column dataField="our_mission" caption="Our Mission"></dxi-column>
        
        <dxi-column dataField="created_by" caption="Created By"></dxi-column>
        <dxi-column dataField="duration" caption="Time Posted"></dxi-column>
            
		<dxo-paging [pageSize]="10"></dxo-paging>
	</dx-data-grid>
	</div>

	<!-- Delete Multiple About Popup -->
    <ng-container *ngIf="selectedAboutForDeletion.length > 0 && deleteMultiplePopupVisible">
		<dx-popup [(visible)]="deleteMultiplePopupVisible" height="auto" width="auto" [showTitle]="true" title="Delete Confirmation"
			(onHidden)="deleteMultiplePopupVisible = false">
			<div>
				<p class="confirmation-text">
					Are you sure you want to delete <strong>{{selectedAboutCount}}</strong> About(s)?
				</p>
				<div class="button-container-popup">
					<dx-button text="Cancel" (onClick)="deleteMultiplePopupVisible = false" [elementAttr]="{ id: 'first-btn', class: 'pull-right' }"></dx-button>
					<dx-button text="Delete" type="danger" (onClick)="confirmDeleteMultipleAbout()" [elementAttr]="{ class: 'pull-right' }">
						<!-- spinner -->
						<ng-container *ngIf="!isSubmitting">Delete</ng-container>
						<ng-container *ngIf="isSubmitting">
							<div class="spinnerc"></div>
						</ng-container>
						<!-- spinner -->
					</dx-button>
				</div>
			</div>
		</dx-popup>
	</ng-container>

</div>
